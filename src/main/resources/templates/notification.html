<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8" />
	<title>Notifications - FriendBook</title>
	<link rel="stylesheet" th:href="@{/css/style.css}" />
	<style>
		.navbar {
			display: flex;
			justify-content: space-between;
			align-items: center;
			background-color: #1f2937;
			padding: 10px 20px;
			border-radius: 12px;
			margin-bottom: 20px;
			color: white;
		}

		.navbar a {
			color: white;
			text-decoration: none;
			margin-right: 15px;
			font-weight: bold;
		}

		.navbar a:hover {
			text-decoration: underline;
		}

		.notification-card {
			border: 1px solid #ddd;
			padding: 10px;
			margin: 10px 0;
			border-radius: 8px;
		}
	</style>
</head>

<body>
	<div class="dashboard-container">
		<div class="navbar">
			<div class="nav-left">
				<a th:href="@{/user/dashboard(email=${user.email})}">Home</a>
				<a th:href="@{/user/notifications(email=${user.email})}">Notifications</a>
				<a th:href="@{/user/search(email=${user.email})}">Search</a>
				<a th:href="@{/user/feed(email=${user.email})}">Feed</a> 
			</div>
			<div class="nav-right">
				<span th:text="${user.name}"></span>
			</div>
		</div>

		<h2>Notifications</h2>
		<hr />

		<div
			th:if="${(notifications == null or notifications.isEmpty()) and (otherNotifications == null or otherNotifications.isEmpty())}">
			<p>No notifications yet.</p>
		</div>

		<div class="notifications">
			<!-- Pending follow requests -->
			<div th:each="n : ${notifications}" class="notification-card">
				<p><b>Follow Request</b><br />
					<span th:text="${n.sender.name} + ' wants to follow you'"></span>
				</p>
				<small th:text="${#temporals.format(n.createdAt,'dd-MM-yyyy HH:mm')}"></small>
				<form th:action="@{/user/follow-requests/accept}" method="post" style="display:inline;">
					<input type="hidden" name="requestId" th:value="${n.id}" />
					<input type="hidden" name="email" th:value="${user.email}" />
					<button type="submit">Accept</button>
				</form>
				<form th:action="@{/user/follow-requests/reject}" method="post" style="display:inline;">
					<input type="hidden" name="requestId" th:value="${n.id}" />
					<input type="hidden" name="email" th:value="${user.email}" />
					<button type="submit">Reject</button>
				</form>
			</div>

			<!-- Follow-back notification -->
			<div th:each="notif : ${otherNotifications}" class="notification-card">
				<p><b th:text="${notif.title}"></b><br />
					<span th:text="${notif.messagePart1}"></span>
				</p>
				<small th:text="${#temporals.format(notif.createdAt,'dd-MM-yyyy HH:mm')}"></small>
				<form th:if="${notif.followBackUserId != null}" th:action="@{/user/follow-toggle}" method="post">
					<input type="hidden" name="email" th:value="${user.email}" />
					<input type="hidden" name="targetId" th:value="${notif.followBackUserId}" />
					<input type="hidden" name="isFollowBack" value="true" />
					<button type="submit">Follow Back</button>
				</form>

			</div>
		</div>
	</div>
</body>

</html>